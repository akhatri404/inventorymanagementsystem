{% extends "base.html" %}
{% block content %}

<h4 class="mb-3 bg-success text-center text-white py-3">商品表: Total Count - {{ page_obj.paginator.count }} </h4>

<form method="get" action="{% url 'product_list' %}">
    <div class="input-group mb-3 gap-2">
        <input type="text" id="searchBar2" name="search" class="form-control" placeholder="Search by JAN code" value="{{ search }}">
        <button class="btn btn-sm btn-light border" type="submit">Search</button>
        <a href="{% url 'product_list' %}" class="btn btn-secondary">X</a>
    </div>
</form>

<div class="d-flex justify-content-between align-items-center mb-3">

    <!-- Left side buttons -->
    <div>
        <a href="{% url 'add_product' %}" class="btn btn-success">Add New Product</a>

        {% if request.user.is_staff %}
            <a href="{% url 'upload_products' %}" class="btn btn-info">Add Bulk Products</a>
            <a href="{% url 'upload_yayoi_codes' %}" class="btn btn-warning">Update Yayoi Codes</a>
        {% endif %}
    </div>

    <!-- Right side dropdown filter -->
    <div class="dropdown">
        <button class="btn btn-secondary border dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            {{ status_filter|default:"All"|title }}
        </button>
        <ul class="dropdown-menu" aria-labelledby="filterDropdown">
            <li><a class="dropdown-item" href="?status=all&search={{ search }}" >All</a></li>
            <li><a class="dropdown-item" href="?status=active&search={{ search }}" >Active</a></li>
            <li><a class="dropdown-item" href="?status=inactive&search={{ search }}" >Inactive</a></li>
        </ul>
    </div>

</div>


<table id="productTable" class="table table-hover align-middle table-bordered border-secondary-subtle">
    <thead>
        <tr>
            <th>#</th>
            <th>弥生</th>
            <th>JAN Code</th>
            <th>商品</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        {% for p in products %}
      
        <tr {% if p.is_active %}
            data-status="active"
        {% else %}
            data-status="inactive"
        {% endif %}>
            <td align="center">{{ forloop.counter0|add:start_index|add:1 }}</td>
            <td>{{ p.yayoi_code }} </td>
            <td>{{ p.jan_code }}</td>
            <td>{{ p.product_name }}</td>
            <td align="center">
                {% if p.is_active %}
                    <a href="{% url 'toggle_product_status' p.yayoi_code %}" class="btn btn-primary btn-sm">Active</a>
                {% else %}
                    <a href="{% url 'toggle_product_status' p.yayoi_code %}" class="btn btn-warning btn-sm">Inactive</a>
                {% endif %}
            </td>
            <td align="center">
                <a href="{% url 'update_product' p.yayoi_code %}" class="btn btn-success btn-sm">Edit</a>
                <a href="{% url 'delete_product' p.yayoi_code %}" class="btn btn-danger btn-sm">Delete</a>
            </td>
        </tr>      
        {% endfor %}    
    </tbody>
</table>

        <!-- Pagination Controls -->
<nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">

        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}&search={{ search }}&status={{ status_filter }}">前</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">前</span></li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                </li>
            {% else %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ num }}&search={{ search }}&status={{ status_filter }}">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}&search={{ search }}&status={{ status_filter }}">次</a>
            </li>
        {% else %}
            <li class="page-item disabled"><span class="page-link">次</span></li>
        {% endif %}

    </ul>
</nav>

<!-- <script>
function filterStatus(status, element) {
    const rows = document.querySelectorAll('#productTable tbody tr');
    rows.forEach(row => {
        if (status === 'all') {
            row.style.display = '';
        } else {
            row.style.display = row.dataset.status === status ? '' : 'none';
        }
    });
    // Update dropdown button text
    const dropdownBtn = document.getElementById('filterDropdown');
    dropdownBtn.textContent = element.textContent;
}
</script> -->

{% endblock %}
